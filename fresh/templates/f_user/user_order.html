{%extends 'base_left.html'%}

{%block js%}

<script type="text/javascript">
	$(function(){
		$('#order').addClass('active').parent().siblings().children('a').removeClass('active')
		$('.login_btn').html('欢迎您:{{name}}<span>|</span><a href="/user/logout/">退出</a>')	

		count = 0
		count1 = 0
		$('.order_goods_list').each(function(){
			p = $(this).children('.col02').children().children().text()
			n = $(this).children('.col03').text()
			$(this).children('.col04').children().text(parseFloat(p*n).toFixed(2))
			if($(this).prop('id')=='nopay'){
				count1 += p*n
			}
			else{
				count += p*n
			}			
		})

		$('.go_pay').submit(function(){
			if($('#nopay').length==0){
				alert('木有需要付款滴')
				return false
			}
		})

	})
</script>

{%endblock js%}

{%block content2%}

<div class="right_content clearfix">
				<h3 class="common_title2">全部订单</h3>
				{%for i in page%}
				<ul class="order_list_th w978 clearfix">
					<li class="col01">{{i.odate}}</li>
					<li class="col02">订单号：{{i.oid}}</li>
					{%if i.oIsPay%}
					<li class="col02 stress">已支付</li>
					{%else%}
					<li class="col02 stress">未支付</li>
					{%endif%}
				</ul>

				<table class="order_list_table w980">
			
					<tbody>
						<tr>
							<td width="55%" class="nopay_length">
								
								{%for j in i.orderdetailinfo_set.all%}
								<ul class="order_goods_list clearfix" id="nopay">					
									<li class="col01"><img src="/static/{{j.goods.gpic}}"></li>
									<li class="col02">{{j.goods.gtitle|truncatechars:15}}<em><em>{{j.goods.gprice}}</em>元/{{j.goods.gunit}}g</em></li>	
									<li class="col03">{{j.count}}</li>
									<li class="col04"><em></em>元</li>	
								</ul>
									{%endfor%}
							
							</td>
							{%if i.oIsPay%}
							<td width="15%"><em class="pay_all">{{i.ototal}}</em>元</td>
							<td width="15%">已付款</td>
							<td width="15%"><a href="#" class="oper_btn">查看物流</a></td>
							{%else%}
							<td width="15%"><em class="no_pay_all">{{i.ototal}}</em>元</td>
							<td width="15%">待付款</td>				
							<td width="15%"><a href="/order/pay{{i.oid}}/" class="oper_btn">去付款</a></td>
							{%endif%}
							
						</tr>
						
					
					</tbody>
				</table>
				{%empty%}
				<h3>还没有订单信息</h3>
				{%endfor%}

				
		
				<div class="pagenation">
			{%if page.has_previous%}
			<a href="/user/user_order{{page.number|add:-1}}"><上一页</a>
			{%endif%}
			{%for i in page.paginator.page_range%}

			{%if i == page.number%}
				<a href="/user/user_order{{i}}" class="active">{{i}}</a>
			{%else%}
			<a href="/user/user_order{{i}}">{{i}}</a>
		
			{%endif%}

			{%endfor%}
				{%if page.has_next%}
				<a href="/user/user_order{{page.number|add:1}}">下一页></a>
				{%endif%}
			</div>
		</div>
	</div>

{%endblock content2%}